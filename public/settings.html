<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Settings | Champ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .settings-container {
            max-width: 600px;
            margin: 40px auto;
            padding: 30px;
        }
    </style>
</head>

<body>
    <header class="navbar">
        <div class="container nav-container">
            <a href="/" class="logo">CHAMP.</a>
            <nav class="nav-links" id="nav-links">
                <a href="/">Home</a>
                <a href="/products.html">Products</a>
                <div class="auth-links" id="auth-links"></div>
                <a href="/cart.html" class="cart-icon"><i class="fas fa-shopping-bag"></i><span class="cart-count"
                        id="cart-count">0</span></a>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="settings-container glass-panel">
            <h2 style="margin-bottom: 24px; text-align: center;">Profile Settings</h2>

            <div id="settings-message"
                style="margin-bottom: 20px; text-align: center; padding: 10px; border-radius: 4px; display: none;">
            </div>

            <form id="settings-form">
                <div class="form-group">
                    <label for="name">Display Name</label>
                    <input type="text" id="name" class="form-control" required>
                </div>

                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="email" class="form-control" disabled
                        style="background-color: var(--background-color); cursor: not-allowed; opacity: 0.7;">
                    <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Email cannot be
                        changed.</small>
                </div>

                <div class="form-group">
                    <label for="password">New Password</label>
                    <input type="password" id="password" class="form-control"
                        placeholder="Leave blank to keep current password">
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;" id="save-btn">Save
                    Changes</button>
            </form>

            <div style="margin-top: 40px; border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 24px;">
                <h3 style="margin-bottom: 20px;">More Options</h3>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <a href="/orders.html" class="btn btn-outline" style="justify-content: flex-start;">
                        <i class="fas fa-box-open" style="width: 24px;"></i> Manage & Cancel Orders
                    </a>
                    <a href="#" class="btn btn-outline" style="justify-content: flex-start;"
                        onclick="alert('Contact Support: support@champ.com\nWe typically respond within 24 hours.')">
                        <i class="fas fa-envelope" style="width: 24px;"></i> Contact Us
                    </a>
                    <a href="#" class="btn btn-outline" style="justify-content: flex-start;"
                        onclick="alert('Requesting a call from Champ Support...\nOur team will reach out to you shortly.')">
                        <i class="fas fa-phone" style="width: 24px;"></i> Call Me
                    </a>
                    <a href="#" class="btn btn-outline" style="justify-content: flex-start;"
                        onclick="alert('Terms and Conditions:\n\n1. All products come with a 1-year warranty.\n2. Returns are accepted within 30 days.\n3. We value and protect your privacy.')">
                        <i class="fas fa-file-contract" style="width: 24px;"></i> Terms & Conditions
                    </a>
                </div>
            </div>
        </div>
    </main>

    <script src="/js/auth.js"></script>
    <script src="/js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const user = auth.getUser();
            if (!user) {
                window.location.href = '/login.html';
                return;
            }

            document.getElementById('name').value = user.name;
            document.getElementById('email').value = user.email;

            document.getElementById('settings-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('name').value;
                const password = document.getElementById('password').value;
                const messageEl = document.getElementById('settings-message');
                const btn = document.getElementById('save-btn');

                btn.innerText = 'Saving...';
                btn.disabled = true;

                try {
                    const res = await fetch('/api/user/profile', {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name, password })
                    });

                    const data = await res.json();
                    messageEl.style.display = 'block';

                    if (res.ok) {
                        messageEl.style.backgroundColor = 'rgba(46, 213, 115, 0.2)';
                        messageEl.style.color = '#2ed573';
                        messageEl.innerText = data.message;
                        auth.setCurrentUser(data.user); // Update local storage and UI
                        document.getElementById('password').value = ''; // clear password
                    } else {
                        messageEl.style.backgroundColor = 'rgba(255, 71, 87, 0.2)';
                        messageEl.style.color = '#ff4757';
                        messageEl.innerText = data.message;
                    }
                } catch (err) {
                    console.error('Save error', err);
                    messageEl.style.display = 'block';
                    messageEl.style.backgroundColor = 'rgba(255, 71, 87, 0.2)';
                    messageEl.style.color = '#ff4757';
                    messageEl.innerText = 'Network error occurred.';
                } finally {
                    btn.innerText = 'Save Changes';
                    btn.disabled = false;
                    setTimeout(() => { messageEl.style.display = 'none'; }, 5000);
                }
            });
        });
    </script>
</body>

</html>